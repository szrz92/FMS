<div class="d-flex">
    <div class="flex-fill">
        <div class="d-flex">
            @foreach (var i in imageDataUrls)
            {
                <div class="col-3 mb-2 p-2">
                    <img src="@i" style="width:90%;height:auto;" @onclick="() => DisplayImage(i)" />
                </div>
            }
            <div style="display: flex; align-items: flex-start; justify-content: flex-end; width: 100%;">
                <div class="mr-3">
                    <div class="container1">
                        <div class="button-wrap">
                            <label class="btn btn-fms btn-md text-uppercase font-weight-bold chat-send py-8 px-6" for="upload">Upload File</label>
                            <InputFile id="upload" OnChange="@OnInputFileChange" style=" display:none; position: absolute; z-index: -3; top: 15px; left: 20px; font-size: 17px; color: #b8b8b8;" multiple />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="flex-fill">
        <div class="card">
            <div class="card-header">
                <div class="card-title mb-0 font-weight-bolder">Photo Viewer</div>
            </div>
            <div class="card-body">
                <img src="@displayImage" style="width:99%;height:auto;" />
            </div>
        </div>
    </div>
</div>
<Modal @ref="modal">
    <Title>This is a <em>Title!</em></Title>
    <Body>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Omnes enim iucundum motum, quo sensus hilaretur.
            <i>Quis istud possit, inquit, negare?</i>
            <mark>Ego vero isti, inquam, permitto.</mark> Duo Reges: constructio interrete.
        </p>
        <dl>
            <dt><dfn>Stoici scilicet.</dfn></dt>
            <dd>An hoc usque quaque, aliter in vita?</dd>
            <dt><dfn>Erat enim Polemonis.</dfn></dt>
            <dd>Quod cum accidisset ut alter alterum necopinato videremus, surrexit statim.</dd>
        </dl>
    </Body>
    <Footer>
        <button type="button" class="btn btn-primary">Save changes</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal" @onclick="() => modal.Close()">Close</button>
    </Footer>
</Modal>
@code {
    public Modal modal { get; set; }

    [Parameter]
    public EventCallback<string> OnImagePost { get; set; }

    public string displayImage;
    private IList<string> imageDataUrls = new List<string>();
    public void DisplayImage(string item)
    {
        displayImage = item;
    }


    private async Task OnInputFileChange(InputFileChangeEventArgs e)
    {
        var maxAllowedFiles = 3;
        var format = "image/png";

        foreach (var imageFile in e.GetMultipleFiles(maxAllowedFiles))
        {
            var resizedImageFile = await imageFile.RequestImageFileAsync(format,
                100, 100);
            var buffer = new byte[resizedImageFile.Size];
            await resizedImageFile.OpenReadStream().ReadAsync(buffer);
            var imageDataUrl =
                $"data:{format};base64,{Convert.ToBase64String(buffer)}";
            imageDataUrls.Add(imageDataUrl);

            await OnImagePost.InvokeAsync(imageDataUrl);
        }
    }
}
